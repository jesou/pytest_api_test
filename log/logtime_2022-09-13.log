2022-09-13 02:27:54-INFO-数据库连接成功
2022-09-13 02:27:54-INFO-请求地址：'http://10.18.18.112:30085/sdc/v1/vessels/analytics/ports/sailing/time', 请求方法：post, 请求头：{'Accept': 'application/json, text/plain, */*', 'Accept-Encoding': 'gzip, deflate', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Connection': 'keep-alive', 'Content-Type': 'application/json', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'}, 请求参数：{"startTime":"2022-09-08 00:00:00","endTime":"2022-09-08 16:30:04","cargoTypes":[],"cargoTypeUnknown":false,"isFullLoad":"","startPortCodes":[],"endPortCodes":["CNSHA"],"nextPortCodes":[],"endPortBerthUuids":[],"mmsiList":[],"group":"DAY"}
2022-09-13 02:27:54-INFO-开始执行sql：with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code
2022-09-13 02:27:54-INFO-执行sql: with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code 
 查询结果：RealDictRow([('dwt_sum', '258234'), ('sail_sum', '42')])
2022-09-13 02:27:54-INFO-断言1：实际结果: - 682936，期望结果：- 258234
2022-09-13 02:27:54-INFO-数据库关闭成功
2022-09-13 02:32:37-INFO-数据库连接成功
2022-09-13 02:32:37-INFO-请求地址：'http://10.18.18.112:30085/sdc/v1/vessels/analytics/ports/sailing/time', 请求方法：post, 请求头：{'Accept': 'application/json, text/plain, */*', 'Accept-Encoding': 'gzip, deflate', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Connection': 'keep-alive', 'Content-Type': 'application/json', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'}, 请求参数：{"startTime":"2022-09-08 00:00:00","endTime":"2022-09-08 16:30:04","cargoTypes":[],"cargoTypeUnknown":false,"isFullLoad":"","startPortCodes":[],"endPortCodes":["CNSHA"],"nextPortCodes":[],"endPortBerthUuids":[],"mmsiList":[],"group":"DAY"}
2022-09-13 02:32:38-INFO-开始执行sql：with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code
2022-09-13 02:32:38-INFO-执行sql: with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code 
 查询结果：RealDictRow([('dwt_sum', '258234'), ('sail_sum', '42')])
2022-09-13 02:32:38-INFO-断言1：实际结果: - 682936，期望结果：- 258234
2022-09-13 02:32:38-INFO-数据库关闭成功
2022-09-13 02:35:40-INFO-数据库连接成功
2022-09-13 02:35:40-INFO-请求地址：'http://10.18.18.112:30085/sdc/v1/vessels/analytics/ports/sailing/time', 请求方法：post, 请求头：{'Accept': 'application/json, text/plain, */*', 'Accept-Encoding': 'gzip, deflate', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Connection': 'keep-alive', 'Content-Type': 'application/json', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'}, 请求参数：{"startTime":"2022-09-08 00:00:00","endTime":"2022-09-08 16:30:04","cargoTypes":[],"cargoTypeUnknown":false,"isFullLoad":"","startPortCodes":[],"endPortCodes":["CNSHA"],"nextPortCodes":[],"endPortBerthUuids":[],"mmsiList":[],"group":"DAY"}
2022-09-13 02:35:40-INFO-开始执行sql：with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code
2022-09-13 02:35:40-INFO-执行sql: with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code 
 查询结果：RealDictRow([('dwt_sum', '258234'), ('sail_sum', '42')])
2022-09-13 02:35:41-INFO-数据库关闭成功
2022-09-13 02:36:18-INFO-数据库连接成功
2022-09-13 02:36:18-INFO-请求地址：'http://10.18.18.112:30085/sdc/v1/vessels/analytics/ports/sailing/time', 请求方法：post, 请求头：{'Accept': 'application/json, text/plain, */*', 'Accept-Encoding': 'gzip, deflate', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Connection': 'keep-alive', 'Content-Type': 'application/json', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'}, 请求参数：{"startTime":"2022-09-08 00:00:00","endTime":"2022-09-08 16:30:04","cargoTypes":[],"cargoTypeUnknown":false,"isFullLoad":"","startPortCodes":[],"endPortCodes":["CNSHA"],"nextPortCodes":[],"endPortBerthUuids":[],"mmsiList":[],"group":"DAY"}
2022-09-13 02:36:19-INFO-开始执行sql：with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code
2022-09-13 02:36:19-INFO-执行sql: with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code 
 查询结果：RealDictRow([('dwt_sum', '258234'), ('sail_sum', '42')])
2022-09-13 02:36:19-INFO-数据库关闭成功
2022-09-13 02:39:05-INFO-数据库连接成功
2022-09-13 02:39:05-INFO-请求地址：'http://10.18.18.112:30085/sdc/v1/vessels/analytics/ports/sailing/time', 请求方法：post, 请求头：{'Accept': 'application/json, text/plain, */*', 'Accept-Encoding': 'gzip, deflate', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Connection': 'keep-alive', 'Content-Type': 'application/json', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'}, 请求参数：{"startTime":"2022-09-08 00:00:00","endTime":"2022-09-08 16:30:04","cargoTypes":[],"cargoTypeUnknown":false,"isFullLoad":"","startPortCodes":[],"endPortCodes":["CNSHA"],"nextPortCodes":[],"endPortBerthUuids":[],"mmsiList":[],"group":"DAY"}
2022-09-13 02:39:05-INFO-开始执行sql：with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code
2022-09-13 02:39:05-INFO-执行sql: with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code 
 查询结果：RealDictRow([('dwt_sum', '258234'), ('sail_sum', '42')])
2022-09-13 02:39:05-INFO-数据库关闭成功
2022-09-13 02:39:21-INFO-数据库连接成功
2022-09-13 02:39:21-INFO-请求地址：'http://10.18.18.112:30085/sdc/v1/vessels/analytics/ports/sailing/time', 请求方法：post, 请求头：{'Accept': 'application/json, text/plain, */*', 'Accept-Encoding': 'gzip, deflate', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Connection': 'keep-alive', 'Content-Type': 'application/json', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'}, 请求参数：{"startTime":"2022-09-08 00:00:00","endTime":"2022-09-08 16:30:04","cargoTypes":[],"cargoTypeUnknown":false,"isFullLoad":"","startPortCodes":[],"endPortCodes":["CNSHA"],"nextPortCodes":[],"endPortBerthUuids":[],"mmsiList":[],"group":"DAY"}
2022-09-13 02:39:21-INFO-开始执行sql：with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code
2022-09-13 02:39:21-INFO-执行sql: with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code 
 查询结果：RealDictRow([('dwt_sum', '258234'), ('sail_sum', '42')])
2022-09-13 02:39:21-INFO-断言1：实际结果: - 682936，期望结果：- 258234
2022-09-13 02:39:22-INFO-数据库关闭成功
2022-09-13 02:41:02-INFO-数据库连接成功
2022-09-13 02:41:02-INFO-请求地址：'http://10.18.18.112:30085/sdc/v1/vessels/analytics/ports/sailing/time', 请求方法：post, 请求头：{'Accept': 'application/json, text/plain, */*', 'Accept-Encoding': 'gzip, deflate', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Connection': 'keep-alive', 'Content-Type': 'application/json', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'}, 请求参数：{"startTime":"2022-09-08 00:00:00","endTime":"2022-09-08 16:30:04","cargoTypes":[],"cargoTypeUnknown":false,"isFullLoad":"","startPortCodes":[],"endPortCodes":["CNSHA"],"nextPortCodes":[],"endPortBerthUuids":[],"mmsiList":[],"group":"DAY"}
2022-09-13 02:41:02-INFO-开始执行sql：with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code
2022-09-13 02:41:02-INFO-执行sql: with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code 
 查询结果：RealDictRow([('dwt_sum', '283998'), ('sail_sum', '48')])
2022-09-13 02:41:02-INFO-断言1：实际结果: - 682936，期望结果：- 283998
2022-09-13 02:41:03-INFO-数据库关闭成功
2022-09-13 02:45:28-INFO-数据库连接成功
2022-09-13 02:45:28-INFO-请求地址：'http://10.18.18.112:30085/sdc/v1/vessels/analytics/ports/sailing/time', 请求方法：post, 请求头：{'Accept': 'application/json, text/plain, */*', 'Accept-Encoding': 'gzip, deflate', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Connection': 'keep-alive', 'Content-Type': 'application/json', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'}, 请求参数：{"startTime":"2022-09-08 00:00:00","endTime":"2022-09-08 16:30:04","cargoTypes":[],"cargoTypeUnknown":false,"isFullLoad":"","startPortCodes":[],"endPortCodes":["CNSHA"],"nextPortCodes":[],"endPortBerthUuids":[],"mmsiList":[],"group":"DAY"}
2022-09-13 02:45:29-INFO-开始执行sql：with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code
2022-09-13 02:45:29-INFO-执行sql: with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code 
 查询结果：RealDictRow([('dwt_sum', '283998'), ('sail_sum', '48')])
2022-09-13 02:45:29-INFO-断言1：实际结果: - 682936，期望结果：- 283998
2022-09-13 02:45:29-INFO-数据库关闭成功
2022-09-13 03:48:29-INFO-数据库连接成功
2022-09-13 03:48:29-INFO-请求地址：'http://10.18.18.112:30085/sdc/v1/vessels/analytics/ports/sailing/time', 请求方法：post, 请求头：{'Accept': 'application/json, text/plain, */*', 'Accept-Encoding': 'gzip, deflate', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Connection': 'keep-alive', 'Content-Type': 'application/json', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'}, 请求参数：{"startTime":"2022-09-08 00:00:00","endTime":"2022-09-08 16:30:04","cargoTypes":[],"cargoTypeUnknown":false,"isFullLoad":"","startPortCodes":[],"endPortCodes":["CNSHA"],"nextPortCodes":[],"endPortBerthUuids":[],"mmsiList":[],"group":"DAY"}
2022-09-13 03:48:29-INFO-开始执行sql：with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code
2022-09-13 03:48:29-INFO-执行sql: with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code 
 查询结果：RealDictRow([('dwt_sum', '283998'), ('sail_sum', '48')])
2022-09-13 03:48:29-INFO-断言1：实际结果: - 682936，期望结果：- 283998
2022-09-13 03:48:30-INFO-数据库关闭成功
2022-09-13 03:48:53-INFO-数据库连接成功
2022-09-13 03:48:53-INFO-请求地址：'http://10.18.18.112:30085/sdc/v1/vessels/analytics/ports/sailing/time', 请求方法：post, 请求头：{'Accept': 'application/json, text/plain, */*', 'Accept-Encoding': 'gzip, deflate', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Connection': 'keep-alive', 'Content-Type': 'application/json', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'}, 请求参数：{"startTime":"2022-09-08 00:00:00","endTime":"2022-09-08 16:30:04","cargoTypes":[],"cargoTypeUnknown":false,"isFullLoad":"","startPortCodes":[],"endPortCodes":["CNSHA"],"nextPortCodes":[],"endPortBerthUuids":[],"mmsiList":[],"group":"DAY"}
2022-09-13 03:48:53-INFO-开始执行sql：with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code
2022-09-13 03:48:53-INFO-执行sql: with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code 
 查询结果：RealDictRow([('dwt_sum', '283998'), ('sail_sum', '48')])
2022-09-13 03:48:53-INFO-断言1：实际结果: - 682936，期望结果：- 283998
2022-09-13 03:48:53-INFO-数据库关闭成功
2022-09-13 04:40:59-INFO-数据库连接成功
2022-09-13 04:40:59-INFO-请求地址：'http://10.18.18.112:30085/sdc/v1/vessels/analytics/ports/sailing/time', 请求方法：post, 请求头：{'Accept': 'application/json, text/plain, */*', 'Accept-Encoding': 'gzip, deflate', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Connection': 'keep-alive', 'Content-Type': 'application/json', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'}, 请求参数：{"startTime":"2022-09-08 00:00:00","endTime":"2022-09-08 16:30:04","cargoTypes":[],"cargoTypeUnknown":false,"isFullLoad":"","startPortCodes":[],"endPortCodes":["CNSHA"],"nextPortCodes":[],"endPortBerthUuids":[],"mmsiList":[],"group":"DAY"}
2022-09-13 04:40:59-INFO-开始执行sql：with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code
2022-09-13 04:40:59-INFO-执行sql: with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code 
 查询结果：RealDictRow([('dwt_sum', '319680'), ('sail_sum', '53')])
2022-09-13 04:40:59-INFO-断言1：实际结果: - 682936，期望结果：- 319680
2022-09-13 04:41:00-INFO-数据库关闭成功
2022-09-13 04:50:18-INFO-数据库连接成功
2022-09-13 04:50:18-INFO-请求地址：'http://10.18.18.112:30085/sdc/v1/vessels/analytics/ports/sailing/time', 请求方法：post, 请求头：{'Accept': 'application/json, text/plain, */*', 'Accept-Encoding': 'gzip, deflate', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Connection': 'keep-alive', 'Content-Type': 'application/json', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'}, 请求参数：{"startTime":"2022-09-08 00:00:00","endTime":"2022-09-08 16:30:04","cargoTypes":[],"cargoTypeUnknown":false,"isFullLoad":"","startPortCodes":[],"endPortCodes":["CNSHA"],"nextPortCodes":[],"endPortBerthUuids":[],"mmsiList":[],"group":"DAY"}
2022-09-13 04:50:18-INFO-开始执行sql：with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code
2022-09-13 04:50:18-INFO-执行sql: with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code 
 查询结果：RealDictRow([('dwt_sum', '319680'), ('sail_sum', '53')])
2022-09-13 04:50:18-INFO-断言1：实际结果: - 682936，期望结果：- 319680
2022-09-13 04:50:19-INFO-数据库关闭成功
2022-09-13 05:16:30-INFO-数据库连接成功
2022-09-13 05:16:30-INFO-请求地址：'http://10.18.18.112:30085/sdc/v1/vessels/analytics/ports/sailing/time', 请求方法：post, 请求头：{'Accept': 'application/json, text/plain, */*', 'Accept-Encoding': 'gzip, deflate', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Connection': 'keep-alive', 'Content-Type': 'application/json', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'}, 请求参数：{"startTime":"2022-09-08 00:00:00","endTime":"2022-09-08 16:30:04","cargoTypes":[],"cargoTypeUnknown":false,"isFullLoad":"","startPortCodes":[],"endPortCodes":["CNSHA"],"nextPortCodes":[],"endPortBerthUuids":[],"mmsiList":[],"group":"DAY"}
2022-09-13 05:16:30-INFO-开始执行sql：with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code
2022-09-13 05:16:30-INFO-执行sql: with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code 
 查询结果：RealDictRow([('dwt_sum', '330483'), ('sail_sum', '55')])
2022-09-13 05:16:30-INFO-断言1：实际结果: - 682936，期望结果：- 330483
2022-09-13 05:16:31-INFO-数据库关闭成功
2022-09-13 05:41:01-INFO-数据库连接成功
2022-09-13 05:41:01-INFO-请求地址：'http://10.18.18.112:30085/sdc/v1/vessels/analytics/ports/sailing/time', 请求方法：post, 请求头：{'Accept': 'application/json, text/plain, */*', 'Accept-Encoding': 'gzip, deflate', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Connection': 'keep-alive', 'Content-Type': 'application/json', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'}, 请求参数：{"startTime":"2022-09-08 00:00:00","endTime":"2022-09-08 16:30:04","cargoTypes":[],"cargoTypeUnknown":false,"isFullLoad":"","startPortCodes":[],"endPortCodes":["CNSHA"],"nextPortCodes":[],"endPortBerthUuids":[],"mmsiList":[],"group":"DAY"}
2022-09-13 05:41:01-INFO-开始执行sql：with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code
2022-09-13 05:41:01-INFO-执行sql: with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code 
 查询结果：RealDictRow([('dwt_sum', '330483'), ('sail_sum', '55')])
2022-09-13 05:41:01-INFO-断言1：实际结果: - 682936，期望结果：- 330483
2022-09-13 05:41:02-INFO-数据库关闭成功
2022-09-13 05:42:12-INFO-数据库连接成功
2022-09-13 05:42:12-INFO-请求地址：'http://10.18.18.112:30085/sdc/v1/vessels/analytics/ports/sailing/time', 请求方法：post, 请求头：{'Accept': 'application/json, text/plain, */*', 'Accept-Encoding': 'gzip, deflate', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Connection': 'keep-alive', 'Content-Type': 'application/json', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'}, 请求参数：{"startTime":"2022-09-08 00:00:00","endTime":"2022-09-08 16:30:04","cargoTypes":[],"cargoTypeUnknown":false,"isFullLoad":"","startPortCodes":[],"endPortCodes":["CNSHA"],"nextPortCodes":[],"endPortBerthUuids":[],"mmsiList":[],"group":"DAY"}
2022-09-13 05:42:13-INFO-开始执行sql：with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code
2022-09-13 05:42:13-INFO-执行sql: with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code 
 查询结果：RealDictRow([('dwt_sum', '330483'), ('sail_sum', '55')])
2022-09-13 05:42:13-INFO-断言1：实际结果: - 682936，期望结果：- 330483
2022-09-13 05:42:13-INFO-数据库关闭成功
2022-09-13 05:49:26-INFO-数据库连接成功
2022-09-13 05:49:27-INFO-请求地址：'http://10.18.18.112:30085/sdc/v1/vessels/analytics/ports/sailing/time', 请求方法：post, 请求头：{'Accept': 'application/json, text/plain, */*', 'Accept-Encoding': 'gzip, deflate', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Connection': 'keep-alive', 'Content-Type': 'application/json', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36'}, 请求参数：{"startTime":"2022-09-08 00:00:00","endTime":"2022-09-08 16:30:04","cargoTypes":[],"cargoTypeUnknown":false,"isFullLoad":"","startPortCodes":[],"endPortCodes":["CNSHA"],"nextPortCodes":[],"endPortBerthUuids":[],"mmsiList":[],"group":"DAY"}
2022-09-13 05:49:27-INFO-开始执行sql：with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code
2022-09-13 05:49:27-INFO-执行sql: with port_dwt as (SELECT
ep.port_code end_port_code,
MAX ( ep.name_cn ) end_port_name_cn,
MAX ( ep.name_en ) end_port_name_en,
SUM ( fm_vessel.dwt ) dwt_sum,
COUNT ( 1 ) sail_sum
FROM
sdc_dw.v_vessel_dynamics_berth dt_vessel_dynamics
INNER JOIN sdc_dw.fm_port sp ON dt_vessel_dynamics.leg_start_port_code = sp.port_code
AND dt_vessel_dynamics.mmsi = ANY (
SELECT
fm_vessel.mmsi
FROM
sdc_dw.fm_vessel
WHERE
1 = 1
AND ( retire_year_month IS NULL OR to_date( fm_vessel.retire_year_month :: VARCHAR, 'YYYYMMDD' ) > to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp )
)
AND dt_vessel_dynamics.start_postime >= to_char(current_timestamp,'yyyy-MM-dd 00:00:00')::timestamp
AND dt_vessel_dynamics.start_postime <= to_char(current_timestamp,'yyyy-MM-dd hh24:mi:ss')::timestamp
AND ais_abnormal_times <= 0
AND leg_start_port_code <> leg_end_port_code
AND leg_start_port_code <> 'AAAAA'
AND leg_end_port_code <> 'AAAAA'
INNER JOIN sdc_dw.fm_port ep ON dt_vessel_dynamics.leg_end_port_code = ep.port_code
AND ep.port_code IN ('CNSHA')
INNER JOIN sdc_dw.fm_vessel ON fm_vessel.mmsi = dt_vessel_dynamics.mmsi
LEFT JOIN sdc_dw.fm_port_berth ON fm_port_berth.berth_uuid = dt_vessel_dynamics.leg_start_berth_uuid
GROUP BY
sp.port_code,
ep.port_code)

select
SUM(port_dwt.dwt_sum) dwt_sum,
SUM(port_dwt.sail_sum) sail_sum
from port_dwt
group by end_port_code 
 查询结果：RealDictRow([('dwt_sum', '330483'), ('sail_sum', '55')])
2022-09-13 05:49:27-INFO-断言1：实际结果: - 682936，期望结果：- 330483
2022-09-13 05:49:27-INFO-数据库关闭成功
